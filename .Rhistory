DENS11 = DENS(POP.y), UB11 = UB(POP.y),
DENS12 = DENS(POP.x.x), UB12 = UB(POP.x.x),
DENS13 = DENS(POP.y.y), UB13 = UB(POP.y.y),
DENS14 = DENS(POP), UB14 = UB(POP))  %>%
select(FIPS,STATE= STATENAME2,COUNTY=COUNTYNAME,
DENS10, UB10,DENS11, UB11, DENS12, UB12,DENS13,
UB13,DENS14, UB14 )%>% drop_na()
summary(dfCSS)
dfCSS1 <- dfCSS  %>% group_by(STATE ) %>%
summarise( mean_DENS10 = mean(DENS10),
mean_DENS11 = mean(DENS11),
mean_DENS12 = mean(DENS12),
mean_DENS13 = mean(DENS13),
mean_DENS14 = mean(DENS14))
dfCSS_m <- melt(dfCSS1 , id.vars="STATE")
#Everything on the same plot
m1 <- ggplot(dfCSS_m , aes(STATE, value, col=variable,group = variable)) +
geom_point() +
#stat_smooth() +
theme_minimal()+
theme(axis.title.x=element_blank(),
axis.text.x=element_blank())
# Separate plots
m2 <- ggplot(dfCSS_m , aes(STATE, value, col=variable,group = variable)) +
geom_line() +
facet_wrap(~variable)+
theme_minimal()+
theme(axis.title.x=element_blank(),
axis.text.x=element_blank())
ggarrange(m1, m2, nrow =2)
dfNCHSraw <- read_excel("NCHSURCodes2013.xlsx")
colnames(dfNCHSraw )
dfNCHS <- dfNCHSraw %>% select(FIPS = "FIPS code",County = 'County name',
STATE = 'State Abr.', Code13 ='2013 code' ,
Code06 ='2006 code') %>%
mutate(newCounty = str_replace_all(County, c(" Municipality| Census Area| Borough| City and Borough| County| city| Parish"),"")) %>%
mutate(COUNTY = str_replace_all(newCounty, "LaSalle","La Salle"))%>%
select(FIPS,STATE,COUNTY,Code13, Code06) %>%
mutate( FIPS = as.character(FIPS),UB06 = ifelse(Code06 <=4, 1,0)  )#,UB13 = ifelse(Code13 <=4, 1,0))
#population larger than 50,000
summary(dfNCHS)
cnt <- bind_cols(dfCSS %>% count(UB10) %>% select( Urban = UB10, count10 = n) ,
dfCSS %>% count(UB11) %>% select( count11 = n) ,
dfCSS %>% count(UB12) %>% select( count12 = n) ,
dfCSS %>% count(UB13) %>% select( count13 = n),
dfCSS %>% count(UB14) %>% select( count14 = n) ) %>%
mutate( Urban = as.factor(Urban) )
formattable( cnt,list(
`count11` = formatter("span",  style = ~ style(color =
ifelse(`count11`>`count10`, "red", "green")),
~ icontext(ifelse(`count11`>`count10`,"arrow-up", "arrow-down"), `count11`) ),
`count12` = formatter("span",  style = ~ style(color =
ifelse(`count12`>`count11`, "red", "green")),
~ icontext(ifelse(`count12`>`count11`,"arrow-up", "arrow-down"), `count12`) ),
`count13` = formatter("span",  style = ~ style(color =
ifelse(`count13`>`count12`, "red", "green")),
~ icontext(ifelse(`count13`>`count12`,"arrow-up", "arrow-down"), `count13`) ),
`count14` = formatter("span",  style = ~ style(color =
ifelse(`count14`>`count13`, "red", "green")),
~ icontext(ifelse(`count14`>`count13`,"arrow-up", "arrow-down"), `count14`) )
) )
dfPOP <- dfCSS[,c('FIPS','STATE','COUNTY','DENS14','DENS13','DENS12','DENS11','DENS10',
'UB14','UB13','UB12','UB11','UB10')]
summarized_county_annual(county = "Mingo", state = "WV",key = "WaPo") %>%
select(FIPS = countyfips, STATE = BUYER_STATE, COUNTY = BUYER_COUNTY,DOSAGE_UNIT)
#summarized_county_monthly(county = "Mingo", state = "WV",key = "WaPo")  #300 thousand
getDrug <- function(s,c){
s = toString(s)
c = toString(c)
data = summarized_county_annual(county = c, state = s, key = "WaPo")
if (!length(data) == 0 ){
data %>% select(FIPS = countyfips, YEAR = year, STATE = BUYER_STATE, COUNTY = BUYER_COUNTY,DOSAGE_UNIT)
}
}
summarized_county_annual(county = "DOLORES", state = "CO", key = "WaPo")
dfAnnualDosage <- read.csv('annual_dosage_unit.csv', header=TRUE, row.names=1) %>%mutate(FIPS = as.character(FIPS))
dfAnnual <- dfPOP  %>%
left_join(dfAnnualDosage[, c('FIPS','YEAR','DOSAGE_UNIT')], by='FIPS' ) %>%
filter(!is.na(YEAR))  %>% mutate_each_(funs(factor(.)),
c('YEAR','UB10','UB11','UB12','UB13','UB14'))
head(dfAnnual)
summary(dfAnnual)
ggplot(dfAnnual , aes(x = YEAR, y = DOSAGE_UNIT, colour = YEAR)) +
geom_boxplot()+
labs(title = "DOSAGE_UNIT Change Over Year")+
theme_minimal()
df <- dfAnnual %>% filter(YEAR %in% c('2010', '2011', '2012', '2013', '2014'))
df_dens <- df %>% mutate( dens_DOSAGE = case_when(
YEAR=='2010' ~ DOSAGE_UNIT/ DENS10,
YEAR=='2011' ~ DOSAGE_UNIT/ DENS11,
YEAR=='2012' ~ DOSAGE_UNIT/ DENS12,
YEAR=='2013' ~ DOSAGE_UNIT/ DENS13,
YEAR=='2014' ~ DOSAGE_UNIT/ DENS14))
MinMax <- function(x){
(x-min(x))/(max(x)-min(x)) }
df_gp <- rbind(subset(df, YEAR =='2010') %>% group_by(UB10) %>%
mutate(gp_DOSAGE = MinMax(DOSAGE_UNIT) ),
subset(df, YEAR =='2011') %>% group_by(UB11) %>%
mutate(gp_DOSAGE = MinMax(DOSAGE_UNIT) ),
subset(df, YEAR =='2012')  %>% group_by(UB12) %>%
mutate( gp_DOSAGE = MinMax(DOSAGE_UNIT)) ,
subset(df, YEAR =='2013')  %>% group_by(UB13) %>%
mutate( gp_DOSAGE = MinMax(DOSAGE_UNIT) ),
subset(df, YEAR =='2014')  %>% group_by(UB14) %>%
mutate( gp_DOSAGE = MinMax(DOSAGE_UNIT) ) )
p1 <- ggplot(df , aes(x = YEAR, y = DOSAGE_UNIT, colour = YEAR)) +
geom_boxplot()+
labs(title = "Without Normalization")+
theme_minimal()
p2 <- ggplot(df_dens, aes(x = YEAR, y = dens_DOSAGE, colour = YEAR)) +
geom_boxplot()+
labs(title = "Density Normalization")+
theme_minimal()
p3 <- ggplot(df_dens, aes(x = YEAR, y = log10(dens_DOSAGE), colour = YEAR)) +
geom_boxplot()+
labs(title = "Density Normalization")+
theme_minimal()
p4 <- ggplot(df_gp, aes(x = YEAR, y = gp_DOSAGE, colour = YEAR)) +
geom_boxplot()+
labs(title = "Group Normalization")+
theme_minimal()
ggarrange(p1, p2, p3,p4, nrow = 2, ncol=2)
p5 <- ggplot(df, aes(y = DOSAGE_UNIT, x = YEAR, colour = UB10, group = UB10)) +
stat_summary(fun.y = mean,
fun.ymin = function(x) mean(x) - sd(x),
fun.ymax = function(x) mean(x) + sd(x),
geom = "pointrange") +
stat_summary(fun.y = mean,
geom = "line") +
facet_wrap( ~ UB10) +
labs(title = "Dosage Change Without Normalization")+
theme_minimal()
p6 <- ggplot(df_dens , aes(y = log10(dens_DOSAGE), x = YEAR, colour = UB10, group = UB10)) +
stat_summary(fun.y = mean,
fun.ymin = function(x) mean(x) - sd(x),
fun.ymax = function(x) mean(x) + sd(x),
geom = "pointrange") +
stat_summary(fun.y = mean,
geom = "line") +
facet_wrap( ~  UB10) +
labs(title = "Dosage Change - Density Normalization")+
theme_minimal()
p7 <- ggplot(df_gp , aes(y = gp_DOSAGE, x = YEAR, colour = UB10, group = UB10)) +
stat_summary(fun.y = mean,
fun.ymin = function(x) mean(x) - sd(x),
fun.ymax = function(x) mean(x) + sd(x),
geom = "pointrange") +
stat_summary(fun.y = mean,
geom = "line") +
facet_wrap( ~  UB10) +
labs(title = "Dosage Change - Group Normalization")+
theme_minimal()
ggarrange(p5, p6, p7,ncol=3 )
d1 <- df_dens  %>% group_by(STATE,YEAR) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
p0 <- ggplot(d1, aes(x = YEAR, y = mean_DOSAGE, color = STATE)) +
geom_line_interactive(aes(group= STATE,
data_id = abbr2state(STATE), tooltip =abbr2state(STATE) ), show.legend = FALSE)+
labs(title = "Mean Dosage Amount Across State")+
theme_minimal()
girafe(code = print(p0) )
summarized_county(county = "California", state = "CA",key = "WaPo")
summarized_county_monthly(county = "California", state = "CA",key = "WaPo")
df_dens[df_dens$STATE=='CA',]
summarized_county_monthly(state = "CA",key = "WaPo")
df_dens[df_dens$STATE=='CA',]
summarized_county_monthly(state = "CA",key = "WaPo")
summarized_county_monthly(state = "CA",key = "WaPo")  %>% group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
knitr::opts_chunk$set(echo = TRUE, message = FALSE,
warning = FALSE)
library(readxl)
library(devtools)
library(usethis)
library(tidyverse)
library(openintro)
library(arcos)
library(ggiraph)
library(ggpubr)
library(ggfortify)
library(ggpol)
library(lme4)
library(formattable)
library(reshape2)
head(read.csv('2010.csv', header=TRUE) )
read_pop <- function(file){
read.csv( file, header=TRUE) %>% slice(2:n()) %>%
mutate(FIPS = str_sub(GEO_ID, -5,-1), POP = as.numeric(as.character(B01003_001E))  ) %>%
select(FIPS, POP)
}
pop2010 <- read_pop('2010.csv')
pop2011 <- read_pop('2011.csv')
pop2012 <- read_pop('2012.csv')
pop2013 <- read_pop('2013.csv')
pop2014 <- read_pop('2014.csv')
dfCSSraw <- read_excel("PctUrbanRural_County.xls")
dfCSSraw$COUNTYNAME <- gsub('LaSalle','La Salle', dfCSSraw$COUNTYNAME)
dfCSSraw$COUNTYNAME <- gsub('Do??a Ana','Dona Ana', dfCSSraw$COUNTYNAME)
dfcss <- dfCSSraw %>% select(STATE,COUNTY,STATENAME,COUNTYNAME,
POP_COU,AREA_COU, POP_URBAN,POPPCT_URBAN,POP_RURAL,POPPCT_RURAL) %>%
filter(STATENAME !='Puerto Rico') %>%
mutate(STATENAME2 = state2abbr(STATENAME), FIPS= paste(STATE,COUNTY,sep=""))
L <- list( pop2010[, c('FIPS','POP')],pop2011[, c('FIPS','POP')],
pop2012[, c('FIPS','POP')], pop2013[, c('FIPS','POP')],
pop2014[, c('FIPS','POP')],dfcss)
DENS<- function(x){return(x/( dfcss$AREA_COU*0.0000003861)) }
UB <- function(x){ return(ifelse( x>= 50000,1,0)) }
dfCSS<-Reduce(function(x,y) left_join(x, y,
by = colnames(x)[1]), L)%>%
mutate(FIPS = str_remove(FIPS, "^0+"),
DENS10 = DENS(POP.x), UB10 = UB(POP.x),
DENS11 = DENS(POP.y), UB11 = UB(POP.y),
DENS12 = DENS(POP.x.x), UB12 = UB(POP.x.x),
DENS13 = DENS(POP.y.y), UB13 = UB(POP.y.y),
DENS14 = DENS(POP), UB14 = UB(POP))  %>%
select(FIPS,STATE= STATENAME2,COUNTY=COUNTYNAME,
DENS10, UB10,DENS11, UB11, DENS12, UB12,DENS13,
UB13,DENS14, UB14 )%>% drop_na()
summary(dfCSS)
dfCSS1 <- dfCSS  %>% group_by(STATE ) %>%
summarise( mean_DENS10 = mean(DENS10),
mean_DENS11 = mean(DENS11),
mean_DENS12 = mean(DENS12),
mean_DENS13 = mean(DENS13),
mean_DENS14 = mean(DENS14))
dfCSS_m <- melt(dfCSS1 , id.vars="STATE")
#Everything on the same plot
m1 <- ggplot(dfCSS_m , aes(STATE, value, col=variable,group = variable)) +
geom_point() +
#stat_smooth() +
theme_minimal()+
theme(axis.title.x=element_blank(),
axis.text.x=element_blank())
# Separate plots
m2 <- ggplot(dfCSS_m , aes(STATE, value, col=variable,group = variable)) +
geom_line() +
facet_wrap(~variable)+
theme_minimal()+
theme(axis.title.x=element_blank(),
axis.text.x=element_blank())
ggarrange(m1, m2, nrow =2)
dfNCHSraw <- read_excel("NCHSURCodes2013.xlsx")
colnames(dfNCHSraw )
dfNCHS <- dfNCHSraw %>% select(FIPS = "FIPS code",County = 'County name',
STATE = 'State Abr.', Code13 ='2013 code' ,
Code06 ='2006 code') %>%
mutate(newCounty = str_replace_all(County, c(" Municipality| Census Area| Borough| City and Borough| County| city| Parish"),"")) %>%
mutate(COUNTY = str_replace_all(newCounty, "LaSalle","La Salle"))%>%
select(FIPS,STATE,COUNTY,Code13, Code06) %>%
mutate( FIPS = as.character(FIPS),UB06 = ifelse(Code06 <=4, 1,0)  )#,UB13 = ifelse(Code13 <=4, 1,0))
#population larger than 50,000
summary(dfNCHS)
cnt <- bind_cols(dfCSS %>% count(UB10) %>% select( Urban = UB10, count10 = n) ,
dfCSS %>% count(UB11) %>% select( count11 = n) ,
dfCSS %>% count(UB12) %>% select( count12 = n) ,
dfCSS %>% count(UB13) %>% select( count13 = n),
dfCSS %>% count(UB14) %>% select( count14 = n) ) %>%
mutate( Urban = as.factor(Urban) )
formattable( cnt,list(
`count11` = formatter("span",  style = ~ style(color =
ifelse(`count11`>`count10`, "red", "green")),
~ icontext(ifelse(`count11`>`count10`,"arrow-up", "arrow-down"), `count11`) ),
`count12` = formatter("span",  style = ~ style(color =
ifelse(`count12`>`count11`, "red", "green")),
~ icontext(ifelse(`count12`>`count11`,"arrow-up", "arrow-down"), `count12`) ),
`count13` = formatter("span",  style = ~ style(color =
ifelse(`count13`>`count12`, "red", "green")),
~ icontext(ifelse(`count13`>`count12`,"arrow-up", "arrow-down"), `count13`) ),
`count14` = formatter("span",  style = ~ style(color =
ifelse(`count14`>`count13`, "red", "green")),
~ icontext(ifelse(`count14`>`count13`,"arrow-up", "arrow-down"), `count14`) )
) )
dfPOP <- dfCSS[,c('FIPS','STATE','COUNTY','DENS14','DENS13','DENS12','DENS11','DENS10',
'UB14','UB13','UB12','UB11','UB10')]
summarized_county_annual(county = "Mingo", state = "WV",key = "WaPo") %>%
select(FIPS = countyfips, STATE = BUYER_STATE, COUNTY = BUYER_COUNTY,DOSAGE_UNIT)
#summarized_county_monthly(county = "Mingo", state = "WV",key = "WaPo")  #300 thousand
getDrug <- function(s,c){
s = toString(s)
c = toString(c)
data = summarized_county_annual(county = c, state = s, key = "WaPo")
if (!length(data) == 0 ){
data %>% select(FIPS = countyfips, YEAR = year, STATE = BUYER_STATE, COUNTY = BUYER_COUNTY,DOSAGE_UNIT)
}
}
summarized_county_annual(county = "DOLORES", state = "CO", key = "WaPo")
dfAnnualDosage <- read.csv('annual_dosage_unit.csv', header=TRUE, row.names=1) %>%mutate(FIPS = as.character(FIPS))
dfAnnual <- dfPOP  %>%
left_join(dfAnnualDosage[, c('FIPS','YEAR','DOSAGE_UNIT')], by='FIPS' ) %>%
filter(!is.na(YEAR))  %>% mutate_each_(funs(factor(.)),
c('YEAR','UB10','UB11','UB12','UB13','UB14'))
head(dfAnnual)
summary(dfAnnual)
ggplot(dfAnnual , aes(x = YEAR, y = DOSAGE_UNIT, colour = YEAR)) +
geom_boxplot()+
labs(title = "DOSAGE_UNIT Change Over Year")+
theme_minimal()
df <- dfAnnual %>% filter(YEAR %in% c('2010', '2011', '2012', '2013', '2014'))
df_dens <- df %>% mutate( dens_DOSAGE = case_when(
YEAR=='2010' ~ DOSAGE_UNIT/ DENS10,
YEAR=='2011' ~ DOSAGE_UNIT/ DENS11,
YEAR=='2012' ~ DOSAGE_UNIT/ DENS12,
YEAR=='2013' ~ DOSAGE_UNIT/ DENS13,
YEAR=='2014' ~ DOSAGE_UNIT/ DENS14))
MinMax <- function(x){
(x-min(x))/(max(x)-min(x)) }
df_gp <- rbind(subset(df, YEAR =='2010') %>% group_by(UB10) %>%
mutate(gp_DOSAGE = MinMax(DOSAGE_UNIT) ),
subset(df, YEAR =='2011') %>% group_by(UB11) %>%
mutate(gp_DOSAGE = MinMax(DOSAGE_UNIT) ),
subset(df, YEAR =='2012')  %>% group_by(UB12) %>%
mutate( gp_DOSAGE = MinMax(DOSAGE_UNIT)) ,
subset(df, YEAR =='2013')  %>% group_by(UB13) %>%
mutate( gp_DOSAGE = MinMax(DOSAGE_UNIT) ),
subset(df, YEAR =='2014')  %>% group_by(UB14) %>%
mutate( gp_DOSAGE = MinMax(DOSAGE_UNIT) ) )
p1 <- ggplot(df , aes(x = YEAR, y = DOSAGE_UNIT, colour = YEAR)) +
geom_boxplot()+
labs(title = "Without Normalization")+
theme_minimal()
p2 <- ggplot(df_dens, aes(x = YEAR, y = dens_DOSAGE, colour = YEAR)) +
geom_boxplot()+
labs(title = "Density Normalization")+
theme_minimal()
p3 <- ggplot(df_dens, aes(x = YEAR, y = log10(dens_DOSAGE), colour = YEAR)) +
geom_boxplot()+
labs(title = "Density Normalization")+
theme_minimal()
p4 <- ggplot(df_gp, aes(x = YEAR, y = gp_DOSAGE, colour = YEAR)) +
geom_boxplot()+
labs(title = "Group Normalization")+
theme_minimal()
ggarrange(p1, p2, p3,p4, nrow = 2, ncol=2)
p5 <- ggplot(df, aes(y = DOSAGE_UNIT, x = YEAR, colour = UB10, group = UB10)) +
stat_summary(fun.y = mean,
fun.ymin = function(x) mean(x) - sd(x),
fun.ymax = function(x) mean(x) + sd(x),
geom = "pointrange") +
stat_summary(fun.y = mean,
geom = "line") +
facet_wrap( ~ UB10) +
labs(title = "Dosage Change Without Normalization")+
theme_minimal()
p6 <- ggplot(df_dens , aes(y = log10(dens_DOSAGE), x = YEAR, colour = UB10, group = UB10)) +
stat_summary(fun.y = mean,
fun.ymin = function(x) mean(x) - sd(x),
fun.ymax = function(x) mean(x) + sd(x),
geom = "pointrange") +
stat_summary(fun.y = mean,
geom = "line") +
facet_wrap( ~  UB10) +
labs(title = "Dosage Change - Density Normalization")+
theme_minimal()
p7 <- ggplot(df_gp , aes(y = gp_DOSAGE, x = YEAR, colour = UB10, group = UB10)) +
stat_summary(fun.y = mean,
fun.ymin = function(x) mean(x) - sd(x),
fun.ymax = function(x) mean(x) + sd(x),
geom = "pointrange") +
stat_summary(fun.y = mean,
geom = "line") +
facet_wrap( ~  UB10) +
labs(title = "Dosage Change - Group Normalization")+
theme_minimal()
ggarrange(p5, p6, p7,ncol=3 )
d1 <- df_dens  %>% group_by(STATE,YEAR) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
p0 <- ggplot(d1, aes(x = YEAR, y = mean_DOSAGE, color = STATE)) +
geom_line_interactive(aes(group= STATE,
data_id = abbr2state(STATE), tooltip =abbr2state(STATE) ),
show.legend = FALSE)+
labs(title = "Mean Dosage Amount Across State")+
theme_minimal()
girafe(code = print(p0) )
ca <- summarized_county_monthly(state = "CA",key = "WaPo")  %>% group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
ts(ca, frequency=12)
ca2 <- ts(ca, frequency=12)
plot.ts(ca2)
ca
ca2 <- ts(ca$mean_DOSAGE, frequency=12)
plot.ts(ca2)
ca2
ca2 <- ts(ca$mean_DOSAGE, frequency=12)
plot.ts(ca2)
state2abbr('North Dakota')
ca <- summarized_county_monthly(state = "CA",key = "WaPo")  %>% group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
nd <- summarized_county_monthly(state = "ND",key = "WaPo")  %>% group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
ca <- summarized_county_monthly(state = "CA",key = "WaPo")  %>% group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
nd <- summarized_county_monthly(state = "ND",key = "WaPo")  %>% group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
ca2 <- ts(ca$mean_DOSAGE, frequency=12)
nd2 <- ts(nd$mean_DOSAGE, frequency=12)
plot.ts(ca2)
plot.ts(nd2)
ca2
rownames(ca2)
ca
acast(ca,year~month)
ca2 <- ts(acast(ca,year~month), frequency=12)
plot.ts(ca2)
ca2
ca2 <- ts(acast(ca,year~month))
plot.ts(ca2)
acast(ca,year~month)
ca2 <- ts(acast(ca,year~month), frequency=12, start=c(2006,01))
ca2
plot.ts(ca2)
plot.ts(acast(ca,year~month))
ca2 <- ts(ca,frequency=12 )
ca2
ts(ca$mean_DOSAGE,frequency=12 )
ca2==acast(ca,year~month)
ca <- summarized_county_monthly(state = "CA",key = "WaPo")  %>%
group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
nd <- summarized_county_monthly(state = "ND",key = "WaPo")  %>%
group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))
ca2 <- ts(ca$mean_DOSAGE,frequency=12)
nd2 <- ts(nd$mean_DOSAGE, frequency=12)
plot.ts(acast(ca,year~month))
ca2
ca
summarized_county_monthly(state = "CA",key = "WaPo")  %>%
group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))%>%
mutate(id=paste(as.factor(year), '-',month ))
getStateDrug <- function(s){
data = summarized_county_monthly(state = s,key = "WaPo")  %>%
group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))%>%
mutate(id=paste(as.factor(year), '-',month )) %>% select(id, mean_DOSAGE)
}
ca <- getStateDrug("CA")
ca
getStateDrug <- function(s){
data = summarized_county_monthly(state = s,key = "WaPo")  %>%
group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))%>%
mutate(id=paste(as.factor(year), '-',month ))
}
ca <- getStateDrug("CA")
nd <- getStateDrug("ND")
getStateDrug <- function(s){
data = summarized_county_monthly(state = s,key = "WaPo")  %>%
group_by(year,month) %>%
summarise( mean_DOSAGE = mean(DOSAGE_UNIT))%>%
mutate(id=paste(as.factor(year), '-',month ))
}
ca <- getStateDrug("CA")%>%
select(id, mean_DOSAGE)
